<!DOCTYPE html>

<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/cat.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|[object Object]:300,300italic,400,400italic,700,700italic|consolas:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":350,"display":"always","padding":18,"offset":40,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>
  <meta name="description" content="0 SQL sql简介  结构化查询语言 任何关系型数据库都支持 第四代 4GL 描述性语言，只说做什么，不说怎么做">
<meta property="og:type" content="article">
<meta property="og:title" content="Oracle SQL">
<meta property="og:url" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/index.html">
<meta property="og:site_name" content="翔翔の据点">
<meta property="og:description" content="0 SQL sql简介  结构化查询语言 任何关系型数据库都支持 第四代 4GL 描述性语言，只说做什么，不说怎么做">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200413001053865.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200306095000479.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200407113342237.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200407113448904.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200413004334644.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200413005310401.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200306103700984.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200306104453200.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200413094939969.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200413095048179.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200413095110819.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200414205612726.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200313091614228.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200313091701960.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200313091833106.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200415120715622.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200313102858035.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200313102934943.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200415122712218.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200310145148675.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200310145539136.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200310150035174.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200310153636547.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200414003319350.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200310153239676.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200414003925922.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200310160118150.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200310160156120.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200310161009017.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200310161314653.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200310161058714.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200310161358726.png">
<meta property="og:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200310164759320.png">
<meta property="article:published_time" content="2020-03-09T16:00:00.000Z">
<meta property="article:modified_time" content="2022-03-28T08:06:09.430Z">
<meta property="article:author" content="zhx">
<meta property="article:tag" content="Oracle">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/03/10/Oracle/OracleSQL/image-20200413001053865.png">

<link rel="canonical" href="http://yoursite.com/2020/03/10/Oracle/OracleSQL/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Oracle SQL | 翔翔の据点</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!--     <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.0.js"></script>
  <script type="text/javascript">
  $(document).ready(function() {
    $('.inactive').click(function(){
      if($(this).siblings('ul').css('display')=='none'){
        $(this).addClass('inactives');
        $(this).siblings('ul').slideDown(100).children('li');
      }else{
        $(this).removeClass('inactives');
        $(this).siblings('ul').slideUp(100);
      }
    })
  });
  </script> -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">翔翔の据点</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Arrogance is the only obstacle to survival. Not weakness or ignorance.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">16</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">9</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">35</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/xiangxiang-cpu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/10/Oracle/OracleSQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar/yeah.jpg">
      <meta itemprop="name" content="zhx">
      <meta itemprop="description" content="中国南京 东南大学 软件学院">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="翔翔の据点">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Oracle SQL
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-10 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-10T00:00:00+08:00">2020-03-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-28 16:06:09" itemprop="dateModified" datetime="2022-03-28T16:06:09+08:00">2022-03-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Oracle/" itemprop="url" rel="index"><span itemprop="name">Oracle</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="0-SQL">0 SQL</h2>
<h3 id="sql简介">sql简介</h3>
<ul>
<li>结构化查询语言</li>
<li>任何关系型数据库都支持</li>
<li>第四代 4GL</li>
<li>描述性语言，只说做什么，不说怎么做</li>
</ul>
<a id="more"></a>
<h3 id="sql分类">sql分类</h3>
<ol>
<li>
<p>QL：</p>
</li>
<li>
<p>DML针对用户数据：insert update delete merge</p>
</li>
<li>
<p>DDL针对系统数据：create alter drop truncate rename comment</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">desc user_tables; <span class="comment">-- 这个表不能insert改，数据字典属于系统数据，但可以通过DDL修改系统数据</span></span><br><span class="line"><span class="comment">-- insert into user_tables(table_name) values('aaa'); 不行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- db12c scott下</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> aaa(<span class="keyword">id</span> <span class="built_in">int</span>);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>DCL权限控制：grant revoke</p>
<p>表不存在，可能是无权限访问，在sys下修改权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span> <span class="keyword">on</span> hr.departments <span class="keyword">to</span> scott;</span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">select</span> <span class="keyword">on</span> hr.departments <span class="keyword">from</span> scott;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>TCL事务控制：commit rollback savepoint</p>
</li>
</ol>
<h3 id="语句解析过程">语句解析过程</h3>
<ul>
<li>
<p>语法分析</p>
</li>
<li>
<p>语义分析</p>
</li>
<li>
<p>权限管理 select * from scott.emp, 没有权限视为这个表不存在</p>
</li>
<li>
<p>生成执行计划 set autot on（可以显示执行过程）</p>
<p>可能形成多个执行计划，评估代价之后，选择最优的计划，生成CPU可以执行的代码</p>
</li>
</ul>
<p>每次解析SQL效率太低，在内存（共享池）中保存已经解析好的代码，避免重复解析</p>
<h3 id="sql语法注意">sql语法注意</h3>
<ul>
<li>关键字不能缩写（和sqlplus命令区分）和跨行</li>
<li>以分号结尾</li>
</ul>
<h3 id="“大小写不敏感”">“大小写不敏感”</h3>
<p>==针对结果，过程不同==</p>
<p>eg</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200413001053865.png" alt="image-20200413001053865" style="zoom: 80%;">
<p>select 中，i不同，数据库就认为是1000条不同的语句，解析1000次</p>
<p>需要绑定变量，使执行速度加快</p>
<p><img src="/2020/03/10/Oracle/OracleSQL/image-20200306095000479.png" alt="image-20200306095000479"></p>
<p>数据库怎么知道一条语句有没有执行过？</p>
<p>不是一个字母一个字母比较，而是比较语句的hash值</p>
<p>字符串不是完全相同时，语句的hash值不同，重新解析？？？：</p>
<ul>
<li>大小写不一样时</li>
<li>多空格少空格</li>
<li>换行不同时（不一定能在查询结果中看出来）（分号另起一行）</li>
<li><strong>要遵循写sql语句的规范</strong>（关键字大写，从句另起一行？？？）</li>
</ul>
<p>sql语句的hash值就不同，但执行计划的hash值相同</p>
<p>如何查看已经缓存的语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">desc v$sql <span class="comment">-- sql_text, hash_value</span></span><br><span class="line"><span class="comment">-- shutdown，startup之后清空</span></span><br><span class="line"> SQL_TEXT                                                       VARCHAR2(1000)</span><br><span class="line"> SQL_FULLTEXT                                                   CLOB</span><br><span class="line"> SQL_ID                                                         VARCHAR2(13)</span><br><span class="line"> HASH_VALUE                                                     NUMBER</span><br><span class="line"> OLD_HASH_VALUE                                                 NUMBER</span><br><span class="line"> PLAN_HASH_VALUE                                                NUMBER</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> sql_text, hash_value, plan_hash_value <span class="keyword">from</span> v$<span class="keyword">sql</span> <span class="keyword">where</span> sql_text <span class="keyword">like</span> <span class="string">'%scott.emp%'</span>;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/03/10/Oracle/OracleSQL/image-20200407113342237.png" alt="image-20200407113342237"></p>
<p><img src="/2020/03/10/Oracle/OracleSQL/image-20200407113448904.png" alt="image-20200407113448904"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> parameter <span class="keyword">cursor</span></span><br><span class="line"><span class="keyword">NAME</span>                                 <span class="keyword">TYPE</span>                   <span class="keyword">VALUE</span></span><br><span class="line"><span class="comment">------------------------------------ ---------------------- ------------------------------</span></span><br><span class="line">cursor_bind_capture_destination      <span class="keyword">string</span>                 <span class="keyword">memory</span>+disk</span><br><span class="line">cursor_invalidation                  <span class="keyword">string</span>                 <span class="keyword">IMMEDIATE</span></span><br><span class="line">cursor_sharing                       <span class="keyword">string</span>                 EXACT</span><br><span class="line">cursor_space_for_time                <span class="built_in">boolean</span>                <span class="literal">FALSE</span></span><br><span class="line">open_cursors                         <span class="built_in">integer</span>                <span class="number">300</span></span><br><span class="line">session_cached_cursors               <span class="built_in">integer</span>                <span class="number">50</span></span><br></pre></td></tr></table></figure>
<p>cursor_sharing取值，用于判断两条sql语句是不是视为同一条语句，不同则需要重新解析</p>
<ul>
<li>
<p>similar – 检查plan_hash_value，一样则视为同一条语句</p>
<p>两条语句可以表面不一样，只要不造成执行计划的不同</p>
</li>
<li>
<p>exact – 检查hash_value，一样则视为同一条语句</p>
<p>两条语句必须完全一致</p>
</li>
</ul>
<p>根据业务选择模板（数据库类型），不能选错，参数都是根据类型变化的：</p>
<p>处理系统（存放当前经常变化的数据，经常重复做一样的事情？？？）</p>
<p>数据仓库（存放历史数据，一般只查询，用作决策支持）</p>
<ul>
<li>环境中语句如果不重复用，用exact加速语句老化？？？，适用于数据仓库</li>
<li>重用语句的话，similar比较合适，适用于处理系统</li>
</ul>
<h2 id="1-QL">1 QL</h2>
<ol>
<li>选择：横向的子集</li>
<li>投影：纵向的子集</li>
<li>连接：一张表的来源可能是两张表</li>
</ol>
<p><strong>dual表</strong></p>
<p>系统保证任何时候都是单行单列（里面的值没有限制）</p>
<p>查询一些和表没有关系的信息（时间）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> dual;</span><br><span class="line">DU</span><br><span class="line"><span class="comment">--</span></span><br><span class="line">X</span><br><span class="line"></span><br><span class="line">SYS@db12c&gt;desc dual</span><br><span class="line"> Name         Null?    Type</span><br><span class="line"> <span class="comment">------------ -------- ------------------------------------</span></span><br><span class="line"> DUMMY                 VARCHAR2(1)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">select</span> <span class="number">3</span>+<span class="number">4</span> <span class="keyword">from</span> dual;</span><br><span class="line">       3+4</span><br><span class="line"><span class="comment">----------</span></span><br><span class="line">         7</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="number">3</span>+<span class="number">4</span> <span class="keyword">as</span> he <span class="keyword">from</span> dual;</span><br><span class="line">        HE</span><br><span class="line"><span class="comment">----------</span></span><br><span class="line">         7</span><br><span class="line">         </span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span> <span class="keyword">from</span> dual;</span><br><span class="line">SYSDATE</span><br><span class="line"><span class="comment">------------</span></span><br><span class="line">12-APR-20</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dual <span class="keyword">values</span>(<span class="string">'Y'</span>); <span class="comment">-- 插不进去记录</span></span><br><span class="line"><span class="keyword">update</span> dual <span class="keyword">set</span> dummy=<span class="string">'Z'</span>; <span class="comment">-- 但是可以改</span></span><br></pre></td></tr></table></figure>
<p>表设计原则</p>
<ul>
<li>不允许一张表孤零零（外键）</li>
<li>从一张表要能访问到其他表</li>
</ul>
<p>查询结果显示格式，可以改的</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200413004334644.png" alt="image-20200413004334644" style="zoom:67%;">
<h3 id="null的三值现象">null的三值现象</h3>
<p>null 相当于未定义的变量，不能说等于或者不等于</p>
<ul>
<li>null == 1 为false</li>
<li>null !=1 为false</li>
<li>判断是不是null ，使用is null</li>
</ul>
<p>eg1</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,mgr <span class="keyword">from</span> scott.emp <span class="keyword">where</span> mgr&lt;&gt;<span class="number">7698</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> empno,ename,mgr <span class="keyword">from</span> scott.emp <span class="keyword">where</span> mgr <span class="keyword">is</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">select</span> empno,ename,mgr <span class="keyword">from</span> scott.emp <span class="keyword">where</span> mgr <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<p>eg2</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal,comm,comm+<span class="number">500</span> <span class="keyword">from</span> scott.emp;</span><br></pre></td></tr></table></figure>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200413005310401.png" alt="image-20200413005310401" style="zoom:67%;">
<ul>
<li>null：不配拿奖金</li>
<li>0：有资格拿奖金，但奖金数位0</li>
</ul>
<p>涨奖金时，只有配拿奖金的人才会涨，null的不会加</p>
<p>order by comm时，null不参加排序，null相当于无穷大</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal,comm <span class="keyword">from</span> scott.emp <span class="keyword">order</span> <span class="keyword">by</span> comm;</span><br><span class="line"><span class="keyword">select</span> empno,ename,sal,comm <span class="keyword">from</span> scott.emp <span class="keyword">order</span> <span class="keyword">by</span> comm <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>
<h3 id="Oracle中引号、字符串连接">Oracle中引号、字符串连接</h3>
<ul>
<li>字符和字符串都使用单引号</li>
<li>双引号用于名字：表的名称、别名、列的名称使用双引号</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">'a'</span> <span class="keyword">from</span> dual; <span class="comment">-- 列名默认大写</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="string">'a'</span> a <span class="keyword">from</span> dual; <span class="comment">-- 默认别名大写</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="string">'a'</span> <span class="string">"a"</span> <span class="keyword">from</span> dual; <span class="comment">-- 双引号内的原样输出，别名变为小写</span></span><br></pre></td></tr></table></figure>
<p>Oracle中 + 就是算术运算，不能用于字符串连接</p>
<p>字符串连接使用双竖线表示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">3</span>+<span class="string">'4'</span> <span class="keyword">from</span> dual; <span class="comment">-- 7</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">'3'</span>+<span class="string">'4'</span> <span class="keyword">from</span> dual; <span class="comment">-- 7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="string">'3'</span> || <span class="string">'4'</span> <span class="keyword">from</span> dual; <span class="comment">-- 34</span></span><br></pre></td></tr></table></figure>
<p>嵌套引号方法（考试里有这些东西）</p>
<ul>
<li>连续两个单引号表示转义</li>
<li>定界符q，不一定是方括号</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">'I''m a student'</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="keyword">select</span> q<span class="string">'[I'</span>m a student]<span class="string">' from dual;</span></span><br></pre></td></tr></table></figure>
<h3 id="去重-distinct-unique">去重 distinct == unique</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">unique</span> department_id <span class="keyword">from</span> hr.employees <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>考试选择题</p>
<p><img src="/2020/03/10/Oracle/OracleSQL/image-20200306103700984.png" alt="image-20200306103700984"></p>
<p>key：bc</p>
<h3 id="order-by">order by</h3>
<h4 id="根据数字排序">根据数字排序</h4>
<p>order by 1 按照<strong>select字段中的</strong>第一列排序（不是原表？？？）</p>
<p>order by 2 按照第二列排序</p>
<h4 id="根据别名排序">根据别名排序</h4>
<p>（别名的原名是一个表达式时，很好用）</p>
<h4 id="复合排序">复合排序</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by aa, bb desc</span><br></pre></td></tr></table></figure>
<p>复合的两个，可以一升一降</p>
<h3 id="having和where的区别">having和where的区别</h3>
<p>where对记录筛选</p>
<p>having对组筛选</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 筛选工资大于2000的个人</span></span><br><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> scott.emp <span class="keyword">where</span> sal&gt;<span class="number">2000</span>;</span><br><span class="line"><span class="comment">-- 筛选平均工资大于2000的部门</span></span><br><span class="line"><span class="keyword">select</span> deptno,<span class="keyword">avg</span>(sal) <span class="keyword">from</span> scott.emp</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> deptno</span><br><span class="line"><span class="keyword">having</span> <span class="keyword">avg</span>(sal)&gt;<span class="number">2000</span>;</span><br></pre></td></tr></table></figure>
<h3 id="比较符">比较符</h3>
<ul>
<li>between and 含两端的值</li>
<li>不等于是 &lt;&gt;</li>
<li>in (set)</li>
<li>like</li>
<li>is null</li>
</ul>
<p>后三个都可以加not</p>
<h4 id="like">like</h4>
<p>%匹配任意多个</p>
<p>_匹配一个</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where xx like &#39;%sga%&#39;;</span><br></pre></td></tr></table></figure>
<h4 id="转义-escape">转义 - escape</h4>
<p><img src="/2020/03/10/Oracle/OracleSQL/image-20200306104453200.png" alt="image-20200306104453200"></p>
<p>匹配AB__开头的记录</p>
<p>每个\只转移后面的一个字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> demo1 <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'AB\_\_%'</span> escape <span class="string">'\'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="实现top-n功能">==实现top n功能==</h3>
<p>考试必考</p>
<p>eg 选择scott.emp表中，sal前两名的记录</p>
<p>错误做法：这样是先选出3条记录，再进行的排序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> scott.emp <span class="keyword">where</span> <span class="keyword">rownum</span>&lt;=<span class="number">3</span> <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>
<h4 id="第一种方法">第一种方法</h4>
<p>12c之前，内嵌视图（子查询）</p>
<p>这个表是乱的，先排好序，再取前三行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> (<span class="keyword">select</span> * <span class="keyword">from</span> scott.emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>) <span class="keyword">where</span> <span class="keyword">rownum</span>&lt;=<span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<h4 id="第二种方法（行限制子句，必考）">第二种方法（行限制子句，必考）</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> scott.emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span> <span class="keyword">fetch</span> <span class="keyword">first</span> <span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">only</span>;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/03/10/Oracle/OracleSQL/image-20200413094939969.png" alt="image-20200413094939969"></p>
<p>如果要把<strong>并列</strong>的全部选出</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> scott.emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span> <span class="keyword">fetch</span> <span class="keyword">first</span> <span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">with</span> <span class="keyword">ties</span>;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/03/10/Oracle/OracleSQL/image-20200413095048179.png" alt="image-20200413095048179"></p>
<p>想要第4、5工资大的记录，offset 3 rows，先将前三个去掉，<strong>偏移</strong>过之后再取前两行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> scott.emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span> </span><br><span class="line"><span class="keyword">offset</span> <span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">fetch</span> <span class="keyword">first</span> <span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">only</span>;</span><br></pre></td></tr></table></figure>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200413095110819.png" alt="image-20200413095110819" style="zoom:67%;">
<h3 id="查询时和用户交互">查询时和用户交互</h3>
<ol>
<li>&amp; 接受用户的输入</li>
<li>define</li>
<li>&amp;&amp; 接受用户输入，并define，以后就不用输了，需要时可以undefine</li>
</ol>
<h4 id="1">1. &amp;</h4>
<p>使用提交变量实现</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,job <span class="keyword">from</span> scott.emp <span class="keyword">where</span> empno=&amp;工号;</span><br><span class="line">Enter value for 工号: 7369</span><br><span class="line">old   1: <span class="keyword">select</span> ename,job <span class="keyword">from</span> scott.emp <span class="keyword">where</span> empno=&amp;工号</span><br><span class="line"><span class="keyword">new</span>   <span class="number">1</span>: <span class="keyword">select</span> ename,job <span class="keyword">from</span> scott.emp <span class="keyword">where</span> empno=<span class="number">7369</span></span><br><span class="line"></span><br><span class="line">ENAME                JOB</span><br><span class="line"><span class="comment">-------------------- ----------</span></span><br><span class="line">SMITH                CLERK</span><br></pre></td></tr></table></figure>
<p>练习</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不恰当的例子</span></span><br><span class="line"><span class="keyword">select</span> empno,job <span class="keyword">from</span> scott.emp <span class="keyword">where</span> ename=&amp;姓名; <span class="comment">-- 用户需要输入'SMITH'才能查找成功</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> empno,job <span class="keyword">from</span> scott.emp <span class="keyword">where</span> ename=<span class="keyword">UPPER</span>(<span class="string">'&amp;姓名'</span>);</span><br><span class="line">Enter value for 姓名: james</span><br><span class="line">old   1: <span class="keyword">select</span> empno,job <span class="keyword">from</span> scott.emp <span class="keyword">where</span> ename=<span class="keyword">UPPER</span>(<span class="string">'&amp;姓名'</span>)</span><br><span class="line"><span class="keyword">new</span>   <span class="number">1</span>: <span class="keyword">select</span> empno,job <span class="keyword">from</span> scott.emp <span class="keyword">where</span> ename=<span class="keyword">UPPER</span>(<span class="string">'james'</span>)</span><br><span class="line"></span><br><span class="line">     EMPNO JOB</span><br><span class="line"><span class="comment">---------- ----------</span></span><br><span class="line">      <span class="number">7900</span> CLERK</span><br></pre></td></tr></table></figure>
<h4 id="2-变量">2. 变量</h4>
<p>意义：程序中可能会使用多次，事先定义好，并且修改方便</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SYS@db12c&gt;define gh</span><br><span class="line">SP2-0135: symbol gh is UNDEFINED</span><br><span class="line">SYS@db12c&gt;define gh=7369</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 此时用户就不需要输入了</span></span><br><span class="line">SYS@db12c&gt;select ename,job from scott.emp where empno=&amp;gh;</span><br><span class="line">old   1: <span class="keyword">select</span> ename,job <span class="keyword">from</span> scott.emp <span class="keyword">where</span> empno=&amp;gh</span><br><span class="line"><span class="keyword">new</span>   <span class="number">1</span>: <span class="keyword">select</span> ename,job <span class="keyword">from</span> scott.emp <span class="keyword">where</span> empno=<span class="number">7369</span></span><br><span class="line"></span><br><span class="line">ENAME                JOB</span><br><span class="line"><span class="comment">-------------------- ----------</span></span><br><span class="line">SMITH                CLERK</span><br></pre></td></tr></table></figure>
<p>对变量复制之后之后，再次使用define，会显示这个变量的值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SYS@db12c&gt;define gh</span><br><span class="line">DEFINE GH              = "7369" (CHAR)</span><br><span class="line"><span class="comment">-- 取消定义</span></span><br><span class="line">SYS@db12c&gt;undefine gh</span><br><span class="line">SYS@db12c&gt;define gh</span><br><span class="line">SP2-0135: symbol gh is UNDEFINED</span><br><span class="line"><span class="comment">-- 此时再使用&amp;gh，则还需要用户输入值</span></span><br></pre></td></tr></table></figure>
<h4 id="3">3. &amp;&amp;</h4>
<p>同一变量多次出现在一条语句中，只需要让用户输入一次</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 此时用户需要输入两次一样的值</span></span><br><span class="line"><span class="keyword">select</span> empno,ename,&amp;c3 <span class="keyword">from</span> scott.emp <span class="keyword">order</span> <span class="keyword">by</span> &amp;c3;</span><br><span class="line"></span><br><span class="line">Enter value for c3: sal</span><br><span class="line">Enter value for c3: sal</span><br><span class="line">old   1: <span class="keyword">select</span> empno,ename,&amp;c3 <span class="keyword">from</span> scott.emp <span class="keyword">order</span> <span class="keyword">by</span> &amp;c3</span><br><span class="line"><span class="keyword">new</span>   <span class="number">1</span>: <span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> scott.emp <span class="keyword">order</span> <span class="keyword">by</span> sal</span><br><span class="line"></span><br><span class="line">     EMPNO ENAME                       SAL</span><br><span class="line"><span class="comment">---------- -------------------- ----------</span></span><br><span class="line">      <span class="number">7369</span> SMITH                       <span class="number">800</span></span><br><span class="line">      <span class="number">7900</span> JAMES                       <span class="number">950</span></span><br><span class="line">      <span class="number">7876</span> ADAMS                      <span class="number">1100</span></span><br><span class="line">      <span class="number">7521</span> WARD                       <span class="number">1250</span></span><br><span class="line">      <span class="number">7654</span> MARTIN                     <span class="number">1250</span></span><br><span class="line">      <span class="number">7934</span> MILLER                     <span class="number">1300</span></span><br><span class="line">      <span class="number">7844</span> TURNER                     <span class="number">1500</span></span><br><span class="line">      <span class="number">7499</span> ALLEN                      <span class="number">1600</span></span><br><span class="line">      <span class="number">7782</span> CLARK                      <span class="number">2450</span></span><br><span class="line">      <span class="number">7698</span> BLAKE                      <span class="number">2850</span></span><br><span class="line">      <span class="number">7566</span> JONES                      <span class="number">2975</span></span><br><span class="line">      <span class="number">7788</span> SCOTT                      <span class="number">3000</span></span><br><span class="line">      <span class="number">7902</span> FORD                       <span class="number">3000</span></span><br><span class="line">      <span class="number">7839</span> KING                       <span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="number">14</span> <span class="keyword">rows</span> selected.</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 此时用户只需要输入一次</span></span><br><span class="line"><span class="comment">-- &amp;&amp;意思是，接受用户输入并define</span></span><br><span class="line"><span class="keyword">select</span> empno,ename,&amp;&amp;c3 <span class="keyword">from</span> scott.emp <span class="keyword">order</span> <span class="keyword">by</span> &amp;c3;</span><br><span class="line"></span><br><span class="line">Enter value for c3: sal</span><br><span class="line">old   1: <span class="keyword">select</span> empno,ename,&amp;&amp;c3 <span class="keyword">from</span> scott.emp <span class="keyword">order</span> <span class="keyword">by</span> &amp;c3</span><br><span class="line"><span class="keyword">new</span>   <span class="number">1</span>: <span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> scott.emp <span class="keyword">order</span> <span class="keyword">by</span> sal</span><br><span class="line"></span><br><span class="line">     EMPNO ENAME                       SAL</span><br><span class="line"><span class="comment">---------- -------------------- ----------</span></span><br><span class="line">      <span class="number">7369</span> SMITH                       <span class="number">800</span></span><br><span class="line">      <span class="number">7900</span> JAMES                       <span class="number">950</span></span><br><span class="line">      <span class="number">7876</span> ADAMS                      <span class="number">1100</span></span><br><span class="line">      <span class="number">7521</span> WARD                       <span class="number">1250</span></span><br><span class="line">      <span class="number">7654</span> MARTIN                     <span class="number">1250</span></span><br><span class="line">      <span class="number">7934</span> MILLER                     <span class="number">1300</span></span><br><span class="line">      <span class="number">7844</span> TURNER                     <span class="number">1500</span></span><br><span class="line">      <span class="number">7499</span> ALLEN                      <span class="number">1600</span></span><br><span class="line">      <span class="number">7782</span> CLARK                      <span class="number">2450</span></span><br><span class="line">      <span class="number">7698</span> BLAKE                      <span class="number">2850</span></span><br><span class="line">      <span class="number">7566</span> JONES                      <span class="number">2975</span></span><br><span class="line">      <span class="number">7788</span> SCOTT                      <span class="number">3000</span></span><br><span class="line">      <span class="number">7902</span> FORD                       <span class="number">3000</span></span><br><span class="line">      <span class="number">7839</span> KING                       <span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="number">14</span> <span class="keyword">rows</span> selected.</span><br><span class="line"></span><br><span class="line"><span class="comment">-- &amp;相当于解引用</span></span><br><span class="line"><span class="keyword">SYS</span>@db12c&gt;<span class="keyword">define</span> &amp;c3</span><br><span class="line">SP2<span class="number">-0135</span>: symbol sal <span class="keyword">is</span> UNDEFINED</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 系统自动define，永久</span></span><br><span class="line"><span class="keyword">SYS</span>@db12c&gt;<span class="keyword">define</span> c3</span><br><span class="line"><span class="keyword">DEFINE</span> C3              = <span class="string">"sal"</span> (<span class="built_in">CHAR</span>)</span><br></pre></td></tr></table></figure>
<h3 id="访问多张表方法1-–-连接">访问多张表方法1 – 连接</h3>
<p>nested loop 嵌套循环</p>
<p>基准表、驱动表</p>
<h4 id="内部连接">内部连接</h4>
<p>只连接匹配的行</p>
<p>连接条件两边的字段都不能有null</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL2这种写法，顺序写错会很慢</span></span><br><span class="line"><span class="comment">-- 形成的中间表为两个表的笛卡尔积</span></span><br><span class="line"><span class="keyword">select</span> b.buyer_id,b.buyer_name,s.qty</span><br><span class="line"><span class="keyword">from</span> buyers b,sales s</span><br><span class="line"><span class="keyword">where</span> b.buyer_id = s.buyer_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SQL3这种写法，Oracle会自动调整顺序</span></span><br><span class="line"><span class="comment">-- 形成的中间表为两个表经过ON条件过滤后的笛卡尔积</span></span><br><span class="line"><span class="keyword">select</span> b.buyer_id,b.buyer_name,s.qty</span><br><span class="line"><span class="keyword">from</span> buyers b <span class="keyword">inner</span> <span class="keyword">join</span> sales s</span><br><span class="line"><span class="keyword">on</span> b.buyer_id = s.buyer_id;</span><br><span class="line"><span class="comment">-- (inner可省)</span></span><br></pre></td></tr></table></figure>
<p>==sql语句优化==eg：？？？</p>
<p>起别名提高效率？？？</p>
<p>emp 10万员工 + dept 4个部门（10，20，30，40）</p>
<ul>
<li>from dept,emp：先到部门表取出一个部门10，将10作为条件，和员工表每一条记录匹配，每个表访问4次</li>
<li>from emp,dept：先到员工表取出一位员工，将这个员工作为条件，和部门表每一条记录匹配，每个表访问10万次</li>
</ul>
<p><strong>小表在前，大表在后，减少对表的访问次数？？？</strong></p>
<p><strong>sql从后往前过滤，把筛选掉最多的条件，放在==最后面==</strong></p>
<p><img src="/2020/03/10/Oracle/OracleSQL/image-20200414205612726.png" alt="image-20200414205612726"></p>
<ul>
<li>i - internet 本店</li>
<li>g - grid 连锁店</li>
<li>c - cloud 以租代买</li>
</ul>
<h4 id="外部连接（处理null）">外部连接（处理null）</h4>
<p>==哪边外，哪边所有行数据全部显示==</p>
<p>最好用内部连接，外连接开销大？？？</p>
<h5 id="左外连接">左外连接</h5>
<p>返回左表的全部行和右表满足ON条件的行，如果左表的行在右表中没有匹配，那么这一行右表中对应数据用NULL代替。</p>
<p>from emp,dept</p>
<p>显示全部部门，包括没有员工的部门 122</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL2写法（+）</span></span><br><span class="line">col name for a20</span><br><span class="line">col dept for a20</span><br><span class="line"><span class="keyword">select</span> e.employee_id <span class="keyword">id</span>, e.first_name||<span class="string">' '</span>||e.last_name <span class="keyword">name</span>, d.department_name dept, d.location_id</span><br><span class="line"><span class="keyword">from</span> hr.departments d, hr.employees e</span><br><span class="line"><span class="keyword">where</span> e.department_id(+) = d.department_id;</span><br><span class="line"><span class="comment">-- SQL3写法（join），out都可以省略</span></span><br><span class="line"><span class="keyword">select</span> e.employee_id <span class="keyword">id</span>, e.first_name||<span class="string">' '</span>||e.last_name <span class="keyword">name</span>, d.department_name dept, d.location_id</span><br><span class="line"><span class="keyword">from</span> hr.departments d <span class="keyword">left</span> <span class="keyword">join</span> hr.employees e</span><br><span class="line"><span class="keyword">on</span> e.department_id = d.department_id;</span><br><span class="line"><span class="comment">-- on后面也可以再加and</span></span><br></pre></td></tr></table></figure>
<h5 id="右外连接">右外连接</h5>
<p>返回右表的全部行和左表满足ON条件的行，如果右表的行在左表中没有匹配，那么这一行左表中对应数据用NULL代替。</p>
<p>from emp,dept</p>
<p>显示全部员工，包括没有部门的员工</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">col name for a20</span><br><span class="line">col dept for a20</span><br><span class="line"><span class="keyword">select</span> e.employee_id <span class="keyword">id</span>, e.first_name||<span class="string">' '</span>||e.last_name <span class="keyword">name</span>, d.department_name dept, d.location_id</span><br><span class="line"><span class="keyword">from</span> hr.departments d, hr.employees e</span><br><span class="line"><span class="keyword">where</span> e.department_id = d.department_id(+);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> e.employee_id <span class="keyword">id</span>, e.first_name||<span class="string">' '</span>||e.last_name <span class="keyword">name</span>, d.department_name dept, d.location_id</span><br><span class="line"><span class="keyword">from</span> hr.departments d <span class="keyword">right</span> <span class="keyword">join</span> hr.employees e</span><br><span class="line"><span class="keyword">on</span> e.department_id = d.department_id;</span><br></pre></td></tr></table></figure>
<h5 id="全外连接">全外连接</h5>
<p>会从左表 和右表 那里返回所有的行。如果其中一个表的数据行在另一个表中没有匹配的行，那么对面的数据用NULL代替</p>
<p>全外 = 左外 UNION 右外</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 全外连接 SQL3才支持（不能两边加号）</span></span><br><span class="line">col name for a20</span><br><span class="line">col dept for a20</span><br><span class="line"><span class="keyword">select</span> e.employee_id <span class="keyword">id</span>, e.first_name||<span class="string">' '</span>||e.last_name <span class="keyword">name</span>, d.department_name dept, d.location_id</span><br><span class="line"><span class="keyword">from</span> hr.departments d <span class="keyword">full</span> <span class="keyword">join</span> hr.employees e</span><br><span class="line"><span class="keyword">on</span> e.department_id = d.department_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 内连接</span></span><br><span class="line">col name for a20</span><br><span class="line">col dept for a20</span><br><span class="line"><span class="keyword">select</span> e.employee_id <span class="keyword">id</span>, e.first_name||<span class="string">' '</span>||e.last_name <span class="keyword">name</span>, d.department_name dept, d.location_id</span><br><span class="line"><span class="keyword">from</span> hr.departments d <span class="keyword">join</span> hr.employees e</span><br><span class="line"><span class="keyword">on</span> e.department_id = d.department_id;</span><br></pre></td></tr></table></figure>
<h4 id="多表连接">多表连接</h4>
<p>sales只有(buyer_id, prod_id, qty)，还需要buyers表和product表提供两者的name</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> b.buyer_name,p.prod_name,s.qty</span><br><span class="line"><span class="keyword">from</span> scott.buyers b, scott.sales s, scott.product p</span><br><span class="line"><span class="keyword">where</span> b.buyer_id = s.buyer_id</span><br><span class="line"><span class="keyword">and</span> p.prod_id = s.prod_id;</span><br><span class="line"><span class="comment">-- 相当于两次内连接</span></span><br><span class="line"><span class="keyword">select</span> b.buyer_name,p.prod_name,s.qty</span><br><span class="line"><span class="keyword">from</span> scott.buyers b</span><br><span class="line"><span class="keyword">join</span> scott.sales s</span><br><span class="line"><span class="keyword">on</span> b.buyer_id = s.buyer_id   </span><br><span class="line"><span class="keyword">join</span> scott.product p</span><br><span class="line"><span class="keyword">on</span> p.prod_id = s.prod_id;</span><br></pre></td></tr></table></figure>
<p>最多连4张表，否则效率太低，效率出现拐点</p>
<p>解决方法：物化视图（实体化视图），变成一种存储结构了，但可以和基表同步。了解就行</p>
<ul>
<li>业务系统中，更新频繁时，总是同步物化视图，效率不高</li>
<li>数据仓库，只做查询，不变化时，适用</li>
</ul>
<h4 id="自连接">自连接</h4>
<p>购买同一种水果的顾客（prodid相同，但buyerid不同）</p>
<p>这两个数据在一张表中，所以必须用别名区分</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会查出一样的数据（镜像）</span></span><br><span class="line"><span class="keyword">select</span> a.buyer_id <span class="keyword">as</span> buyer1, b.buyer_id <span class="keyword">as</span> buyer2, a.prod_id</span><br><span class="line"><span class="keyword">from</span> scott.sales a, scott.sales b</span><br><span class="line"><span class="keyword">where</span> a.prod_id = b.prod_id</span><br><span class="line"><span class="keyword">and</span> a.buyer_id &lt;&gt; b.buyer_id;</span><br><span class="line"><span class="comment">-- 大于小于留一个就行</span></span><br><span class="line"><span class="keyword">select</span> a.buyer_id <span class="keyword">as</span> buyer1, b.buyer_id <span class="keyword">as</span> buyer2, a.prod_id</span><br><span class="line"><span class="keyword">from</span> scott.sales a, scott.sales b</span><br><span class="line"><span class="keyword">where</span> a.prod_id = b.prod_id</span><br><span class="line"><span class="keyword">and</span> a.buyer_id &lt; b.buyer_id;</span><br></pre></td></tr></table></figure>
<h4 id="交叉连接（笛卡尔乘积）">交叉连接（笛卡尔乘积）</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> b.buyer_name,s.qty <span class="keyword">from</span> scott.buyers b, scott.sales s;</span><br><span class="line"><span class="keyword">select</span> b.buyer_name,s.qty <span class="keyword">from</span> scott.buyers b <span class="keyword">cross</span> <span class="keyword">join</span> scott.sales s;</span><br></pre></td></tr></table></figure>
<h4 id="自然连接">自然连接</h4>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200313091614228.png" alt="image-20200313091614228" style="zoom:67%;">
<p>自动查找匹配的字段（需要名字相同，且字段类型相同）</p>
<p>有多个相同，则同时匹配；如果没有，则笛卡尔乘积</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200313091701960.png" alt="image-20200313091701960" style="zoom:67%;">
<p>也可以用using指定匹配的字段，using不能（表名.字段），不能有表名</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200313091833106.png" alt="image-20200313091833106" style="zoom:67%;">
<h3 id="访问多张表方法2-–-子查询">访问多张表方法2 – 子查询</h3>
<p>32.07</p>
<h4 id="嵌套子查询">嵌套子查询</h4>
<p>子查询作为条件被外部语句引用，内部查询只执行一次</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal&gt;(<span class="keyword">select</span> sal <span class="keyword">from</span> emp <span class="keyword">where</span> ename = <span class="string">'SMITH'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">where</span> deptno <span class="keyword">in</span> (<span class="keyword">select</span> deptno <span class="keyword">from</span> dept <span class="keyword">where</span> loc <span class="keyword">in</span> (<span class="string">'NEW YORK'</span>,<span class="string">'CHICAGO'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询谁工资最少</span></span><br><span class="line"><span class="keyword">select</span> last_name,job_id,salary</span><br><span class="line"><span class="keyword">from</span> hr.employees</span><br><span class="line"><span class="keyword">where</span> salary = (<span class="keyword">select</span> <span class="keyword">min</span>(salary) <span class="keyword">from</span> hr.employees);</span><br><span class="line"><span class="comment">-- 查询每个部门工资最少的（用group by）</span></span><br></pre></td></tr></table></figure>
<ul>
<li>子查询返回为空，则外部查询不执行</li>
<li>子查询返回一行，则用单行操作符（= &lt; &gt; &lt;= &gt;= &lt;&gt;）</li>
<li>子查询返回多行，则不能使用单行操作符，要用多行操作符（in all any）
<ol>
<li>in 只要满足里面一个就出来</li>
<li>any 取条件最宽松的</li>
<li>all 取条件最严格</li>
</ol>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 工资只要大于1500就好</span></span><br><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal&gt; <span class="keyword">any</span>(<span class="number">1500</span>,<span class="number">2850</span>);</span><br><span class="line"><span class="comment">-- 工资需要大于2850才能</span></span><br><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal&gt; <span class="keyword">all</span>(<span class="number">1500</span>,<span class="number">2850</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- any和all将多个值变为一个值</span></span><br><span class="line"><span class="comment">-- in只能用于判断是否和结果集中的一个相等</span></span><br></pre></td></tr></table></figure>
<p>运算的步骤放在右边效率会高一些。</p>
<p>多列子查询，只需要访问一次内部表即可，提高效率</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200415120715622.png" alt="image-20200415120715622" style="zoom: 80%;">
<h4 id="关联子查询">关联子查询</h4>
<p>和连接相似，外部查询得到的每一条结果传到内部查询中执行【类似于嵌套循环】</p>
<ul>
<li>一般连接的效率高于关联子查询，但关联子查询可读性高</li>
<li>外部查询返回较少记录时,关联子查询比嵌套子查询效果高;</li>
<li>内部查询返回较少记录时,嵌套子查询比关联子查询效果高.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">last_name,salary,department_id条件：高于其部门的平均工资利用关联子查询实现</span><br><span class="line"><span class="keyword">select</span> e.last_name,e.salary,e.department_id</span><br><span class="line"><span class="keyword">from</span> hr.employees e,</span><br><span class="line">  (<span class="keyword">select</span> <span class="keyword">avg</span>(salary) <span class="keyword">as</span> avgsal,department_id <span class="keyword">from</span> hr.employees <span class="keyword">group</span> <span class="keyword">by</span> department_id) s</span><br><span class="line"><span class="keyword">where</span> e.salary &gt; s.avgsal <span class="keyword">and</span> e.DEPARTMENT_ID = s.DEPARTMENT_ID;</span><br><span class="line">  或</span><br><span class="line"><span class="keyword">select</span> e.last_name,e.salary,e.department_id</span><br><span class="line"><span class="keyword">from</span> hr.employees e</span><br><span class="line"><span class="keyword">where</span> salary&gt;(<span class="keyword">select</span> <span class="keyword">avg</span>(salary)<span class="keyword">from</span> hr.employees</span><br><span class="line"><span class="keyword">where</span> e.department_id = department_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> department_id);</span><br></pre></td></tr></table></figure>
<h3 id="处理多个结果集">处理多个结果集</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> depyto =<span class="number">10</span>;</span><br><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> depyto =<span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> deptno = <span class="number">10</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> deptno = <span class="number">30</span>;</span><br></pre></td></tr></table></figure>
<p>两个结果集如何合并？</p>
<p>前提：两者的数据模式要一致</p>
<p>4个操作符：</p>
<pre><code>  1. union 去重
  2. union all 允许重复
  3. intersect 取交集
  4. minus 取第一个结果集去掉交集
</code></pre>
<p>为了保证结构对应，使用to_number(null)，或者直接用0填充</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200313102858035.png" alt="image-20200313102858035" style="zoom:67%;">
<img src="/2020/03/10/Oracle/OracleSQL/image-20200313102934943.png" alt="image-20200313102934943" style="zoom:67%;">
<p>控制结果集的顺序，了解</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200415122712218.png" alt="image-20200415122712218" style="zoom: 80%;">
<h3 id="伪列rownum-level">伪列rownum level</h3>
<p><strong>伪列</strong>就像表中的列一样，但是在表中并不存储。伪列只能查询，不能进行增删改操作。</p>
<ul>
<li>伪列rownum，在查询的结果集中，ROWNUM为结果集中每一行标识一个行号，第一行返回1，第二行返回2，以此类推。通过ROWNUM伪列可以限制查询结果集中返回的行数。</li>
<li>ROWNUM与ROWID不同，ROWID是插入记录时生成，ROWNUM是查询数据时生成</li>
<li>ROWID标识的是行的物理地址。ROWNUM标识的是查询结果中的行的次序。</li>
<li>LEVEL是一个“伪列”，代表树的第几层。对根节点来说，LEVEL返回1，根节点的子节点返回2，以此类推</li>
</ul>
<h3 id="别名">别名</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> last_name <span class="keyword">as</span> <span class="keyword">name</span> <span class="keyword">from</span> employees;</span><br></pre></td></tr></table></figure>
<p>as 可以省略，别名引号？？？</p>
<p>表名加前缀，可以提高性能，别名提高性能？？？</p>
<h2 id="1’-QL函数">1’ QL函数</h2>
<p>找手册：<a href="https://docs.oracle.com/en/database/oracle/oracle-database/20/sqlrf/sql-language-reference.pdf" target="_blank" rel="noopener">https://docs.oracle.com/en/database/oracle/oracle-database/20/sqlrf/sql-language-reference.pdf</a></p>
<h3 id="字符型">字符型</h3>
<h4 id="lower-upper-initcap-concat">lower upper initcap concat</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">lower</span>(<span class="string">'SQL Course'</span>) <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">upper</span>(<span class="string">'SQL Course'</span>) <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> initcap(<span class="string">'SQL Course'</span>) <span class="keyword">from</span> dual; <span class="comment">-- 只把第一个字母大写，其他全部小写</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(<span class="string">'hello'</span>,<span class="string">'world'</span>) <span class="keyword">from</span> dual; <span class="comment">-- 字符串连接函数，不改变大小写，只能两个参数</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(<span class="keyword">concat</span>(<span class="string">'hello'</span>,<span class="string">'Oracle'</span>),<span class="string">'world'</span>) <span class="keyword">from</span> dual; <span class="comment">-- 可以嵌套使用</span></span><br><span class="line"><span class="comment">-- || 也是连接字符串</span></span><br></pre></td></tr></table></figure>
<p>字符（串）加引号之后，大小写敏感</p>
<p>eg 查找人名的时候，不一定改后面的目标数据，可以改表中的数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,sal <span class="keyword">from</span> scott.emp <span class="keyword">where</span> <span class="keyword">lower</span>(ename)=<span class="string">'james'</span>;</span><br></pre></td></tr></table></figure>
<h4 id="length">length</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">length</span>(<span class="string">'hahaha'</span>) <span class="keyword">from</span> dual; <span class="comment">-- 6</span></span><br></pre></td></tr></table></figure>
<h4 id="substr">substr</h4>
<p>下标从1开始，取5个字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">substr</span>(<span class="string">'HelloWorld'</span>,<span class="number">1</span>,<span class="number">5</span>) <span class="keyword">from</span> dual; <span class="comment">-- Hello</span></span><br></pre></td></tr></table></figure>
<p>如果要取到结尾，最后一个参数省略</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">substr</span>(<span class="string">'HelloWorld'</span>,<span class="number">6</span>) <span class="keyword">from</span> dual; <span class="comment">-- World</span></span><br></pre></td></tr></table></figure>
<p>从倒数第五个开始正着取5个</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">substr</span>(<span class="string">'HelloWorld'</span>,<span class="number">-5</span>,<span class="number">4</span>) <span class="keyword">from</span> dual; <span class="comment">-- Worl</span></span><br></pre></td></tr></table></figure>
<h4 id="instr">instr</h4>
<p>查找第一个出现的某字符的位置</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">instr</span>(<span class="string">'HelloWorld'</span>,<span class="string">'W'</span>) <span class="keyword">from</span> dual; <span class="comment">-- 6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">instr</span>(<span class="string">'HelloWorld'</span>,<span class="string">'l'</span>) <span class="keyword">from</span> dual; <span class="comment">-- 3</span></span><br></pre></td></tr></table></figure>
<p>从哪一位开始找起</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">instr</span>(<span class="string">'HelloWorld'</span>,<span class="string">'l'</span>,<span class="number">4</span>) <span class="keyword">from</span> dual; <span class="comment">-- 4</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">instr</span>(<span class="string">'HelloWorld'</span>,<span class="string">'l'</span>,<span class="number">5</span>) <span class="keyword">from</span> dual; <span class="comment">-- 9</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">instr</span>(<span class="string">'HelloWorld'</span>,<span class="string">'l'</span>,<span class="number">-1</span>) <span class="keyword">from</span> dual; <span class="comment">-- 9 从右边第一个找起</span></span><br></pre></td></tr></table></figure>
<p>==从哪一位开始的第几个==</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">instr</span>(<span class="string">'HelloWorld'</span>,<span class="string">'l'</span>,<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">from</span> dual; <span class="comment">-- 3</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">instr</span>(<span class="string">'HelloWorld'</span>,<span class="string">'l'</span>,<span class="number">1</span>,<span class="number">2</span>) <span class="keyword">from</span> dual; <span class="comment">-- 4</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">instr</span>(<span class="string">'HelloWorld'</span>,<span class="string">'l'</span>,<span class="number">1</span>,<span class="number">3</span>) <span class="keyword">from</span> dual; <span class="comment">-- 9</span></span><br></pre></td></tr></table></figure>
<h4 id="lpad-rpad">lpad rpad</h4>
<p>padding – 填充、无意义的废话，和setw类似</p>
<p>lpad即为填充左部，右对齐</p>
<p>rpad即为填充右部，左对齐</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">lpad</span>(last_name,<span class="number">12</span>,<span class="string">'-'</span>) <span class="keyword">from</span> employees; <span class="comment">-- 将位数填充至12位，-是填充符</span></span><br></pre></td></tr></table></figure>
<h4 id="level-pad实现层次查询">level + pad实现层次查询</h4>
<p>用填充，格式化层次型的数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 空格个数(n-1)*2</span></span><br><span class="line">col ename for a30</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">lpad</span>(<span class="string">'-'</span>,(<span class="keyword">level</span><span class="number">-1</span>)*<span class="number">2</span>,<span class="string">'-'</span>) || ename ename, <span class="keyword">level</span> <span class="keyword">from</span> scott.emp</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">with</span> empno=<span class="number">7839</span></span><br><span class="line"><span class="keyword">connect</span> <span class="keyword">by</span> <span class="keyword">prior</span> empno=mgr;</span><br><span class="line"><span class="comment">-- 从最大的领导开始，找下属</span></span><br><span class="line"><span class="comment">-- 也可以从一个小领导开始</span></span><br><span class="line">col ename for a30</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">lpad</span>(<span class="string">'-'</span>,(<span class="keyword">level</span><span class="number">-1</span>)*<span class="number">2</span>,<span class="string">'-'</span>) || ename ename, <span class="keyword">level</span> <span class="keyword">from</span> scott.emp</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">with</span> empno=<span class="number">7839</span></span><br><span class="line"><span class="keyword">connect</span> <span class="keyword">by</span> mgr = <span class="keyword">prior</span> empno;</span><br><span class="line">ENAME                               LEVEL</span><br><span class="line"><span class="comment">------------------------------ ----------</span></span><br><span class="line">KING                                    1</span><br><span class="line"><span class="comment">--JONES                                 2</span></span><br><span class="line"><span class="comment">----SCOTT                               3</span></span><br><span class="line"><span class="comment">------ADAMS                             4</span></span><br><span class="line"><span class="comment">----FORD                                3</span></span><br><span class="line"><span class="comment">------SMITH                             4</span></span><br><span class="line"><span class="comment">--BLAKE                                 2</span></span><br><span class="line"><span class="comment">----ALLEN                               3</span></span><br><span class="line"><span class="comment">----WARD                                3</span></span><br><span class="line"><span class="comment">----MARTIN                              3</span></span><br><span class="line"><span class="comment">----TURNER                              3</span></span><br><span class="line"><span class="comment">----JAMES                               3</span></span><br><span class="line"><span class="comment">--CLARK                                 2</span></span><br><span class="line"><span class="comment">----MILLER                              3</span></span><br><span class="line"></span><br><span class="line">14 rows selected.</span><br><span class="line"></span><br><span class="line">col ename for a30</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">lpad</span>(<span class="string">'-'</span>,(<span class="keyword">level</span><span class="number">-1</span>)*<span class="number">2</span>,<span class="string">'-'</span>)||ename ename, <span class="keyword">level</span> <span class="keyword">from</span> scott.emp</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">with</span> empno=<span class="number">7369</span></span><br><span class="line"><span class="keyword">connect</span> <span class="keyword">by</span> <span class="keyword">prior</span> mgr=empno;</span><br><span class="line"><span class="comment">-- 从最大的领导开始，找下属</span></span><br><span class="line"></span><br><span class="line">ENAME                               LEVEL</span><br><span class="line"><span class="comment">------------------------------ ----------</span></span><br><span class="line">SMITH                                   1</span><br><span class="line"><span class="comment">--FORD                                  2</span></span><br><span class="line"><span class="comment">----JONES                               3</span></span><br><span class="line"><span class="comment">------KING                              4</span></span><br></pre></td></tr></table></figure>
<p>LEVEL是一个“伪列”，代表树的第几层。对根节点来说，LEVEL返回1，根节点的子节点返回2，以此类推</p>
<h4 id="trim">trim</h4>
<p>相当于python中的strip</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">trim</span>(<span class="string">'H'</span> <span class="keyword">from</span> <span class="string">'HelloWorld'</span>) <span class="keyword">from</span> dual;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">trim</span>(<span class="string">'H'</span> <span class="keyword">from</span> <span class="string">'HelloWorldH'</span>) <span class="keyword">from</span> dual;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">trim</span>(<span class="string">'H'</span> <span class="keyword">from</span> <span class="string">'HelloHorld'</span>) <span class="keyword">from</span> dual; <span class="comment">-- 不会去除中间的</span></span><br></pre></td></tr></table></figure>
<h3 id="数字型">数字型</h3>
<h4 id="round（四舍五入）">round（四舍五入）</h4>
<p>两个参数，一个是源数据，第二个是舍入的位数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">round</span>(<span class="number">45.926</span>,<span class="number">2</span>) <span class="keyword">from</span> dual; <span class="comment">-- 45.93</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">round</span>(<span class="number">45.926</span>) <span class="keyword">from</span> dual; <span class="comment">-- 46</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">round</span>(<span class="number">45.926</span>,<span class="number">-1</span>) <span class="keyword">from</span> dual; <span class="comment">-- 50</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>正数表示小数点向右数，1代表十分位，2代表百分位</p>
</li>
<li>
<p>0表示舍入到个位，不写这个参数的话默认值就是0</p>
</li>
<li>
<p>负数表示小数点向左数，-1表示十位，-2百位</p>
</li>
</ul>
<h4 id="trunc（四舍五舍）">trunc（四舍五舍）</h4>
<p>和round语法完全一致，只是将舍入变为一律截断</p>
<h4 id="ceil-floor">ceil floor</h4>
<p>向上取整，向下取整</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">ceil</span>(<span class="number">2.55</span>) <span class="keyword">from</span> dual; <span class="comment">-- 3</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">floor</span>(<span class="number">2.55</span>) <span class="keyword">from</span> dual; <span class="comment">-- 2</span></span><br></pre></td></tr></table></figure>
<h4 id="mod">mod</h4>
<p>取余数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">mod</span>(<span class="number">5</span>,<span class="number">2</span>) <span class="keyword">from</span> dual; <span class="comment">-- 1</span></span><br></pre></td></tr></table></figure>
<h3 id="日期型">日期型</h3>
<p>Oracle中日期类型存储得很全：世纪 - 年 - 月 - 日 - 时 - 分 - 秒</p>
<p>但是查找出来的，只是按照格式显示的一部分</p>
<h4 id="日期格式">日期格式</h4>
<h4 id="sysdate-current-date">sysdate current_date</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span> <span class="keyword">from</span> dual; <span class="comment">-- 按nls_date_format参数格式显示</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">current_date</span> <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<ul>
<li>nls是Oracle初始化参数</li>
<li>和sqlplus的参数区分</li>
</ul>
<p>规定日期格式</p>
<ul>
<li>nls==多级别覆盖问题==，见知识点</li>
<li>alter session 会话级设置，关闭会话，参数失效</li>
<li>alter system 系统级设置（nls不要用system，会被覆盖）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">session</span> <span class="keyword">set</span> nls_date_format=<span class="string">'yyyy-mm-dd hh:mi:ss'</span>;</span><br><span class="line"><span class="comment">-- alter system set nls_date_format='yyyy-mm-dd hh:mi:ss'; -- 不能这样改，scope问题？？？</span></span><br><span class="line"><span class="comment">-- 不能有两个mm：月份为mm，分钟为mi</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span> <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 静态参数？？？修改后，重启Oracle生效？？？</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> nls_date_format=<span class="string">'yyyy-mm-dd hh24:mi:ss'</span> <span class="keyword">scope</span>=<span class="keyword">spfile</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">session</span> <span class="keyword">set</span> nls_date_format=<span class="string">'yyyy-mm-dd hh24:mi:ss am'</span>; <span class="comment">-- 24小时制</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">session</span> <span class="keyword">set</span> nls_date_format=<span class="string">'yyyy-mm-dd hh:mi:ss am'</span>; <span class="comment">-- 12小时制，但有上下午表示</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span> <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<p>千年虫问题：用2位数字表示年份时</p>
<p>年的格式：</p>
<ul>
<li>
<p>yyyy格式，最常用</p>
</li>
<li>
<p>YY格式，和当前日期同一个世纪</p>
</li>
<li>
<p>RR格式（默认），取离当前日期最近的一个世纪</p>
<p>如下图的第二行例子：2017离1995，比1917离1995近，所以取2017</p>
</li>
</ul>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200310145148675.png" alt="image-20200310145148675" style="zoom:67%;">
<h4 id="systimestamp-current-timestamp">systimestamp current_timestamp</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> systimestamp <span class="keyword">from</span> dual; <span class="comment">-- 13-APR-20 11.30.37.074805 PM +08:00</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">current_timestamp</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">-- 按什么格式显示的？？？+08:00东八区</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 括号中的是秒的小数位数（最多9位）</span></span><br><span class="line"><span class="keyword">select</span> systimestamp(<span class="number">3</span>) <span class="keyword">from</span> dual; <span class="comment">-- 13-APR-20 11.32.05.755 PM +08:00</span></span><br><span class="line"><span class="keyword">select</span> systimestamp(<span class="number">9</span>) <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">-- select systimestamp(10) from dual;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">current_timestamp</span> <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<h4 id="date相减">date相减</h4>
<p>查入职时间</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">col last_name for a 20</span><br><span class="line"><span class="keyword">select</span> last_name, (<span class="keyword">sysdate</span>-hire_date)/<span class="number">7</span> <span class="keyword">as</span> weeks</span><br><span class="line"><span class="keyword">from</span> hr.employees</span><br><span class="line"><span class="keyword">where</span> department_id=<span class="number">90</span>;</span><br></pre></td></tr></table></figure>
<h4 id="其他日期函数？？？">其他日期函数？？？</h4>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200310145539136.png" alt="image-20200310145539136" style="zoom:67%;">
<p>month_between 两个日期之间相差多少个月</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 刚刚会话级修改了nls日期格式，注意！</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">session</span> <span class="keyword">set</span> nls_date_format=<span class="string">'DD-MON-RR'</span>;</span><br><span class="line"><span class="keyword">select</span> months_between(<span class="string">'01-SEP-05'</span>, <span class="string">'11-JAN-04'</span>) <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">-- 离现在近的日期放第一个！！！有顺序</span></span><br><span class="line"><span class="comment">-- select months_between('11-JAN-04','01-SEP-05') from dual;</span></span><br><span class="line"><span class="comment">-- 写反了会返回负数（相反数？？？）</span></span><br></pre></td></tr></table></figure>
<p>next_day中最后可以使用数字代替星期（1 - Sun，2 - Tue），下一个星期几是哪一天</p>
<h4 id="日期的舍入-截断">日期的舍入/截断</h4>
<p>判断是不是同一年</p>
<ol>
<li>提取年to_char？？？</li>
<li>截断年</li>
</ol>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200310150035174.png" alt="image-20200310150035174" style="zoom:67%;">
<p>舍入 == 有没有过了这一月/年的一半</p>
<ul>
<li>以月为单位，则结果一定是1号</li>
<li>以年为单位，则结果一定是1.1</li>
</ul>
<h3 id="转换函数">转换函数</h3>
<ul>
<li>显示转换</li>
<li>隐式转换</li>
</ul>
<h4 id="to-char">to_char</h4>
<p>格式在to_char专用？？？和nls_date_format不通用？？？</p>
<p><img src="/2020/03/10/Oracle/OracleSQL/image-20200310153636547.png" alt="image-20200310153636547"></p>
<p>大小写敏感</p>
<p>month Month MONTH不同，其他以此类推</p>
<p>加fm，会把没用的填充“0”去掉（fmdd）</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200414003319350.png" alt="image-20200414003319350" style="zoom:80%;">
<h5 id="日期转换为字符">日期转换为字符</h5>
<p>转换为字符的目的：按照我设定的格式来显示</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200310153239676.png" alt="image-20200310153239676" style="zoom:67%;">
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,hire_date <span class="keyword">from</span> hr.employees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> ename,to_char(hire_date,<span class="string">'yyyy-mm-dd'</span>) <span class="keyword">from</span> hr.employees; <span class="comment">-- 日期格式见上</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">session</span> nls_language=american;</span><br><span class="line"><span class="comment">--NLS_LANG=american_america.ZHS16GBK; export NLS_LANG</span></span><br><span class="line"></span><br><span class="line">to_char(sysdate, ‘yyyy/mm/dd’); <span class="comment">--‘2003/07/09’</span></span><br><span class="line">to_char(sysdate, ‘Month DD, YYYY’); <span class="comment">--‘July 09, 2003’</span></span><br><span class="line">to_char(sysdate, ‘FMMonth DD, YYYY’); <span class="comment">-- ‘July 9, 2003’</span></span><br><span class="line">to_char(sysdate, ‘MON DDth, YYYY’);	<span class="comment">--‘JUL 09TH, 2003’</span></span><br><span class="line">to_char(sysdate, ‘FMMON DDth, YYYY’); <span class="comment">-- ‘JUL 9TH, 2003’</span></span><br><span class="line">to_char(sysdate, ‘FMMon ddth, YYYY’); <span class="comment">-- ‘Jul 9th, 2003’</span></span><br></pre></td></tr></table></figure>
<h5 id="数字转换为字符">数字转换为字符</h5>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200414003925922.png" alt="image-20200414003925922" style="zoom:80%;">
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,to_char(sal,<span class="string">'99,999.99'</span>) <span class="keyword">as</span> sal <span class="keyword">from</span> scott.emp; <span class="comment">-- 位数不够，不会填充</span></span><br><span class="line"><span class="keyword">select</span> empno,ename,to_char(sal,<span class="string">'90,999.99'</span>) <span class="keyword">as</span> sal <span class="keyword">from</span> scott.emp; <span class="comment">-- 第4位强制显示0</span></span><br><span class="line"><span class="keyword">select</span> empno,ename,to_char(sal,<span class="string">'$90,999.99'</span>) <span class="keyword">as</span> sal <span class="keyword">from</span> scott.emp;</span><br><span class="line"><span class="keyword">select</span> empno,ename,to_char(sal,<span class="string">'L90,999.99'</span>) <span class="keyword">as</span> sal <span class="keyword">from</span> scott.emp; <span class="comment">-- 本地货币符号</span></span><br><span class="line"><span class="comment">-- 本地在哪和nls_territory有关，可改为america、china、united kingdom等</span></span><br><span class="line"></span><br><span class="line">to_char(1210.73, ‘9999.9’) <span class="comment">--‘1210.7’</span></span><br><span class="line">to_char(1210.73, ‘9,999.99’) <span class="comment">--‘1,210.73’</span></span><br><span class="line">to_char(1210.73, ‘$9,999.00’) <span class="comment">--‘$1,210.73’</span></span><br><span class="line">to_char(21, ‘000099’) <span class="comment">-- 000021’</span></span><br></pre></td></tr></table></figure>
<h4 id="to-date（使用很多）">to_date（使用很多）</h4>
<p>将字符类型按一定格式转化为日期类型，前后要一致</p>
<p>修改表中date类型数据时，格式不对很麻烦</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- update scott.emp set hiredate='1981-09-05' where empno=7900; -- 格式可能不对</span></span><br></pre></td></tr></table></figure>
<p>==自由写日期格式==，需要使用to_date将字符串改为date类型？？？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> scott.emp <span class="keyword">set</span> hiredate=<span class="keyword">to_date</span>(<span class="string">'1981-09-05'</span>,<span class="string">'yyyy-mm-dd'</span>) <span class="keyword">where</span> empno=<span class="number">7900</span>;</span><br></pre></td></tr></table></figure>
<p>YYYY：四位表示的年份<br>
YYY，YY，Y：年份的最后三位、两位或一位，缺省为当前世纪<br>
MM：01~12的月份编号<br>
MONTH：九个字符表示的月份，右边用空格填补<br>
MON：三位字符的月份缩写<br>
WW：一年中的星期<br>
D：星期中的第几天<br>
DD：月份中的第几天<br>
DDD：年所中的第几天<br>
DAY：九个字符表示的天的全称，右边用空格补齐<br>
HH，HH12：一天中的第几个小时，12进制表示法<br>
HH24：一天中的第几个小时，取值为00~23<br>
MI：一小时中的分钟<br>
SS：一分钟中的秒<br>
SSSS：从午夜开始过去的秒数</p>
<h3 id="处理null值的函数">处理null值的函数</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal,comm <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<p>eg scott.emp中，comm为奖金，可能为空</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200310160118150.png" alt="image-20200310160118150" style="zoom:80%;">
<h4 id="NVL">NVL</h4>
<p>expr1：如果不为null，则返回expr1；为null则返回expr2</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">avg</span>(comm) <span class="keyword">from</span> scott.emp; <span class="comment">-- 550，奖金为null的舍弃</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">avg</span>(nvl(comm,<span class="number">0</span>)) <span class="keyword">from</span> scott.emp; <span class="comment">-- 157.14，奖金为null的按0处理</span></span><br><span class="line"><span class="comment">-- 对奖金进行判断：如果为空，则值为0；如果不为空，则值为奖金数</span></span><br></pre></td></tr></table></figure>
<h4 id="NVL2">NVL2</h4>
<p>expr1：如果不为null，则返回expr2；为null则返回expr3</p>
<p>构造收入 = sal + comm</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal,comm, nvl2(comm,sal+comm,sal) <span class="keyword">as</span> income <span class="keyword">from</span> scott.emp;</span><br></pre></td></tr></table></figure>
<h4 id="NULLIF">NULLIF</h4>
<p>判断expr1和expr2是否相同：如果相同返回null；如果相同，返回expr1</p>
<p><img src="/2020/03/10/Oracle/OracleSQL/image-20200310160156120.png" alt="image-20200310160156120"></p>
<h4 id="COALESC">COALESC</h4>
<p>练习</p>
<p>后面跟一串值，取第一个不为null的值返回</p>
<p>一个数字 + null = null？？？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno, ename, sal, comm, <span class="keyword">coalesce</span>(comm+sal, sal) <span class="keyword">as</span> income <span class="keyword">from</span> scott.emp;</span><br></pre></td></tr></table></figure>
<h3 id="处理if-then-else逻辑">处理if-then-else逻辑</h3>
<h4 id="CASE">CASE</h4>
<p>eg1：特定工种的人加工资</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200310161009017.png" alt="image-20200310161009017" style="zoom:67%;">
<p>eg2：根据工资给员工分档次</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200310161314653.png" alt="image-20200310161314653" style="zoom:67%;">
<h4 id="DECODE（使用很多）">DECODE（使用很多）</h4>
<p>只能用于判断是否相等，<strong>不能判断</strong>大于小于等<strong>范围</strong>关系</p>
<ul>
<li>第一个是待判断的值</li>
<li>后面一对一对看，即为条件和输出</li>
<li>最后一个是else的值</li>
</ul>
<p>eg1：特定工种的人加工资</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200310161058714.png" alt="image-20200310161058714" style="zoom:67%;">
<p>eg2：根据工资等级收税</p>
<img src="/2020/03/10/Oracle/OracleSQL/image-20200310161358726.png" alt="image-20200310161358726" style="zoom:67%;">
<h3 id="组函数">组函数</h3>
<p>和group by搭配使用</p>
<p>不group by则对所有记录的某一字段操作（取最大值等）</p>
<h4 id="greatest-least">greatest least</h4>
<p>max min只能有两个参数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">greatest</span>(<span class="number">1</span>,<span class="number">4</span>,<span class="number">7</span>) <span class="keyword">from</span> dual; <span class="comment">-- 7</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">least</span>(<span class="number">1</span>,<span class="number">4</span>,<span class="number">7</span>) <span class="keyword">from</span> dual; <span class="comment">-- 1</span></span><br></pre></td></tr></table></figure>
<h4 id="avg-count-max-min-sum">avg count max min sum</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="listagg-列表聚合">listagg 列表聚合</h4>
<p>一行显示所有姓名，但也有前后之分（用group）</p>
<p><code>listagg([要聚合的列],'分隔符') within group(order by [按哪个字段排序显示])</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">col ename for a100</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">listagg</span>(ename,<span class="string">','</span>) <span class="keyword">within</span> <span class="keyword">group</span> (<span class="keyword">order</span> <span class="keyword">by</span> empno) <span class="keyword">as</span> ename</span><br><span class="line"><span class="keyword">from</span> scott.emp;</span><br><span class="line"></span><br><span class="line">ENAME</span><br><span class="line"><span class="comment">---------------------------------------------------------------------------------------</span></span><br><span class="line">SMITH,ALLEN,WARD,JONES,MARTIN,BLAKE,CLARK,SCOTT,KING,TURNER,ADAMS,JAMES,FORD,MILLER</span><br></pre></td></tr></table></figure>
<p><img src="/2020/03/10/Oracle/OracleSQL/image-20200310164759320.png" alt="image-20200310164759320"></p>
<h4 id="stddev-偏差">stddev 偏差</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="variance-方差">variance 方差</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="rollup">rollup</h4>
<p>和多分组条件（group by 加多个字段）的区别！</p>
<p>rollby可以对分组==进行小计==，sum？？？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> department_id,job_id,<span class="keyword">sum</span>(salary)</span><br><span class="line"><span class="keyword">from</span> hr.employees</span><br><span class="line"><span class="keyword">where</span> department_id&gt;<span class="number">40</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">rollup</span>(department_id,job_id);</span><br><span class="line"></span><br><span class="line">DEPARTMENT_ID JOB_ID               SUM(SALARY)</span><br><span class="line"><span class="comment">------------- -------------------- -----------</span></span><br><span class="line">           50 ST_MAN                     36400</span><br><span class="line">           50 SH_CLERK                   64300</span><br><span class="line">           50 ST_CLERK                   55700</span><br><span class="line">           50                           156400</span><br><span class="line">           60 IT_PROG                    28800</span><br><span class="line">           60                            28800</span><br><span class="line">           70 PR_REP                     10000</span><br><span class="line">           70                            10000</span><br><span class="line">           80 SA_MAN                     61000</span><br><span class="line">           80 SA_REP                    243500</span><br><span class="line">           80                           304500</span><br><span class="line">           90 AD_VP                      34000</span><br><span class="line">           90 AD_PRES                    24000</span><br><span class="line">           90                            58000</span><br><span class="line">          100 FI_MGR                     12008</span><br><span class="line">          100 FI_ACCOUNT                 39600</span><br><span class="line">          100                            51608</span><br><span class="line">          110 AC_MGR                     12008</span><br><span class="line">          110 AC_ACCOUNT                  8300</span><br><span class="line">          110                            20308</span><br><span class="line">                                        629616</span><br><span class="line"><span class="comment">-- 交换顺序也可以</span></span><br><span class="line"><span class="keyword">select</span> job_id,department_id,<span class="keyword">sum</span>(salary)</span><br><span class="line"><span class="keyword">from</span> hr.employees</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">rollup</span>(job_id,department_id);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> department_id,job_id,<span class="keyword">sum</span>(salary)</span><br><span class="line"><span class="keyword">from</span> hr.employees</span><br><span class="line"><span class="keyword">where</span> department_id&gt;<span class="number">40</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> department_id,job_id+department_id+<span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<h4 id="cube">cube</h4>
<p>“两个方向”都产生小计</p>
<p>第二个方向（job）没有次级详细信息（department）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> department_id,job_id,<span class="keyword">sum</span>(salary)</span><br><span class="line"><span class="keyword">from</span> hr.employees</span><br><span class="line"><span class="keyword">where</span> department_id&gt;<span class="number">40</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">cube</span>(department_id,job_id);</span><br><span class="line"></span><br><span class="line">DEPARTMENT_ID JOB_ID               SUM(SALARY)</span><br><span class="line"><span class="comment">------------- -------------------- -----------</span></span><br><span class="line">                                        629616</span><br><span class="line">              AD_VP                      34000</span><br><span class="line">              AC_MGR                     12008</span><br><span class="line">              FI_MGR                     12008</span><br><span class="line">              PR_REP                     10000</span><br><span class="line">              SA_MAN                     61000</span><br><span class="line">              SA_REP                    243500</span><br><span class="line">              ST_MAN                     36400</span><br><span class="line">              AD_PRES                    24000</span><br><span class="line">              IT_PROG                    28800</span><br><span class="line">              SH_CLERK                   64300</span><br><span class="line">              ST_CLERK                   55700</span><br><span class="line">              AC_ACCOUNT                  8300</span><br><span class="line">              FI_ACCOUNT                 39600</span><br><span class="line">           50                           156400</span><br><span class="line">           50 ST_MAN                     36400</span><br><span class="line">           50 SH_CLERK                   64300</span><br><span class="line">           50 ST_CLERK                   55700</span><br><span class="line">           60                            28800</span><br><span class="line">           60 IT_PROG                    28800</span><br><span class="line">           70                            10000</span><br><span class="line">           70 PR_REP                     10000</span><br><span class="line">           80                           304500</span><br><span class="line">           80 SA_MAN                     61000</span><br><span class="line">           80 SA_REP                    243500</span><br><span class="line">           90                            58000</span><br><span class="line">           90 AD_VP                      34000</span><br><span class="line">           90 AD_PRES                    24000</span><br><span class="line">          100                            51608</span><br><span class="line">          100 FI_MGR                     12008</span><br><span class="line">          100 FI_ACCOUNT                 39600</span><br><span class="line">          110                            20308</span><br><span class="line">          110 AC_MGR                     12008</span><br><span class="line">          110 AC_ACCOUNT                  8300</span><br><span class="line"><span class="keyword">select</span> department_id,job_id,<span class="keyword">sum</span>(salary)</span><br><span class="line"><span class="keyword">from</span> hr.employees</span><br><span class="line"><span class="keyword">where</span> department_id&gt;<span class="number">40</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">cube</span>(department_id,job_id);</span><br></pre></td></tr></table></figure>
<h2 id="1’’-QL练习题">==1’’ QL练习题==</h2>
<h3 id="从全名中取lastname">从全名中取lastname</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> scott.buyers;</span><br><span class="line"><span class="keyword">select</span> buyer_id, <span class="keyword">substr</span>(buyer_name,<span class="keyword">instr</span>(buyer_name,<span class="string">' '</span>)+<span class="number">1</span>) <span class="keyword">from</span> scott.buyers;</span><br><span class="line"><span class="comment">-- 只有一个参数，表示取到结尾</span></span><br></pre></td></tr></table></figure>
<h3 id="根据入职时间长短排序">根据入职时间长短排序</h3>
<p>years + month 降序</p>
<p>5马尔代夫 + 20云南</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> last_name,</span><br><span class="line">	<span class="keyword">floor</span>(months_between(<span class="keyword">current_date</span>,hire_date)/<span class="number">12</span>) <span class="keyword">as</span> <span class="keyword">years</span>,</span><br><span class="line">	<span class="keyword">floor</span>(<span class="keyword">mod</span>(months_between(<span class="keyword">current_date</span>,hire_date),<span class="number">12</span>)) <span class="keyword">as</span> <span class="keyword">months</span></span><br><span class="line"><span class="keyword">from</span> employees</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">years</span> <span class="keyword">desc</span>,<span class="keyword">months</span> <span class="keyword">desc</span></span><br><span class="line"><span class="keyword">fetch</span> <span class="keyword">first</span> <span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">only</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> last_name,</span><br><span class="line">	<span class="keyword">floor</span>(months_between(<span class="keyword">current_date</span>,hire_date)/<span class="number">12</span>) <span class="keyword">as</span> <span class="keyword">years</span>,</span><br><span class="line">	<span class="keyword">floor</span>(<span class="keyword">mod</span>(months_between(<span class="keyword">current_date</span>,hire_date),<span class="number">12</span>)) <span class="keyword">as</span> <span class="keyword">months</span></span><br><span class="line"><span class="keyword">from</span> employees</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">years</span> <span class="keyword">desc</span>,<span class="keyword">months</span> <span class="keyword">desc</span></span><br><span class="line"><span class="keyword">offset</span> <span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">fetch</span> <span class="keyword">first</span> <span class="number">20</span> <span class="keyword">rows</span> <span class="keyword">only</span>;</span><br></pre></td></tr></table></figure>
<h3 id="如果mgr为空，mgr显示boss-0">如果mgr为空，mgr显示boss/0</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">col mgr for a20</span><br><span class="line"><span class="keyword">select</span> empno,ename,nvl(to_char(mgr),<span class="string">'boss'</span>) mgr <span class="keyword">from</span> scott.emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 位数不够也不会强制补0的</span></span><br><span class="line">col mgr for 999999</span><br><span class="line"><span class="keyword">select</span> empno,ename,nvl(mgr,<span class="number">0</span>) mgr <span class="keyword">from</span> scott.emp;</span><br></pre></td></tr></table></figure>
<h3 id="显示特定年份入职的员工数量">显示特定年份入职的员工数量</h3>
<p>用to_char提取年份</p>
<p>decode、case返回一列值（0或1），求和即可计数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">as</span> total, </span><br><span class="line"><span class="keyword">sum</span>(<span class="keyword">decode</span>(to_char(hire_date, <span class="string">'YYYY'</span>),<span class="string">'2001'</span>,<span class="number">1</span>,<span class="number">0</span>)) <span class="string">"2001"</span>,</span><br><span class="line"><span class="keyword">sum</span>(<span class="keyword">decode</span>(to_char(hire_date, <span class="string">'YYYY'</span>),<span class="string">'2002'</span>,<span class="number">1</span>,<span class="number">0</span>)) <span class="string">"2002"</span>,</span><br><span class="line"><span class="keyword">sum</span>(<span class="keyword">decode</span>(to_char(hire_date, <span class="string">'YYYY'</span>),<span class="string">'2003'</span>,<span class="number">1</span>,<span class="number">0</span>)) <span class="string">"2003"</span>,</span><br><span class="line"><span class="keyword">sum</span>(<span class="keyword">decode</span>(to_char(hire_date, <span class="string">'YYYY'</span>),<span class="string">'2008'</span>,<span class="number">1</span>,<span class="number">0</span>)) <span class="string">"2008"</span></span><br><span class="line"><span class="keyword">from</span> hr.employees;</span><br><span class="line"></span><br><span class="line">     TOTAL       2001       2002       2003       2008</span><br><span class="line"><span class="comment">---------- ---------- ---------- ---------- ----------</span></span><br><span class="line">       107          1          7          6         11</span><br><span class="line">       </span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">as</span> total, </span><br><span class="line"><span class="keyword">sum</span>(<span class="keyword">case</span> to_char(hire_date, <span class="string">'YYYY'</span>) <span class="keyword">when</span> <span class="string">'2001'</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="string">"2001"</span>,</span><br><span class="line"><span class="keyword">sum</span>(<span class="keyword">case</span> to_char(hire_date, <span class="string">'YYYY'</span>) <span class="keyword">when</span> <span class="string">'2002'</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="string">"2002"</span>,</span><br><span class="line"><span class="keyword">sum</span>(<span class="keyword">case</span> to_char(hire_date, <span class="string">'YYYY'</span>) <span class="keyword">when</span> <span class="string">'2003'</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="string">"2003"</span>,</span><br><span class="line"><span class="keyword">sum</span>(<span class="keyword">case</span> to_char(hire_date, <span class="string">'YYYY'</span>) <span class="keyword">when</span> <span class="string">'2008'</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="string">"2008"</span></span><br><span class="line"><span class="keyword">from</span> hr.employees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">case</span> to_char(hire_date, <span class="string">'YYYY'</span>) <span class="keyword">when</span> <span class="string">'2001'</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span></span><br><span class="line"><span class="keyword">from</span> hr.employees;</span><br></pre></td></tr></table></figure>
<h3 id="使用case-decode改变表模式">使用case/decode改变表模式</h3>
<p>（姓名，科目，成绩）改为（姓名，科目1成绩，科目2成绩…）</p>
<p>原表模式为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">col name for a10</span><br><span class="line">col subject for a10</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> hr.st;</span><br><span class="line"><span class="comment">-- number类型不能用col for a10</span></span><br><span class="line"></span><br><span class="line">NAME       SUBJECT         SCORE</span><br><span class="line"><span class="comment">---------- ---------- ----------</span></span><br><span class="line">zhangsan   chinese            90</span><br><span class="line">zhangsan   maths             100</span><br><span class="line">zhangsan   english            96</span><br><span class="line">lisi       chinese            94</span><br><span class="line">lisi       maths              98</span><br><span class="line">lisi       english            92</span><br><span class="line"></span><br><span class="line">6 rows selected.</span><br></pre></td></tr></table></figure>
<p>注意是单引号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>, </span><br><span class="line"><span class="keyword">max</span>(<span class="keyword">case</span> subject <span class="keyword">when</span> <span class="string">'chinese'</span> <span class="keyword">then</span> score <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) chinese,</span><br><span class="line"><span class="keyword">max</span>(<span class="keyword">case</span> subject <span class="keyword">when</span> <span class="string">'maths'</span> <span class="keyword">then</span> score <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) maths,</span><br><span class="line"><span class="keyword">max</span>(<span class="keyword">case</span> subject <span class="keyword">when</span> <span class="string">'english'</span> <span class="keyword">then</span> score <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) english</span><br><span class="line"><span class="keyword">from</span> hr.st</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>, </span><br><span class="line"><span class="keyword">max</span>(<span class="keyword">decode</span>(subject,<span class="string">'chinese'</span>,score,<span class="number">0</span>))<span class="string">"chinese"</span>,</span><br><span class="line"><span class="keyword">max</span>(<span class="keyword">decode</span>(subject,<span class="string">'maths'</span>,score,<span class="number">0</span>))<span class="string">"maths"</span>,</span><br><span class="line"><span class="keyword">max</span>(<span class="keyword">decode</span>(subject,<span class="string">'english'</span>,score,<span class="number">0</span>))<span class="string">"english"</span></span><br><span class="line"><span class="keyword">from</span> hr.st</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span>;</span><br><span class="line"></span><br><span class="line">NAME          chinese      maths    english</span><br><span class="line"><span class="comment">---------- ---------- ---------- ----------</span></span><br><span class="line">zhangsan           90        100         96</span><br><span class="line">lisi               94         98         92</span><br></pre></td></tr></table></figure>
<h3 id="聚合显示">聚合显示</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按dept分类，姓名聚合显示，内部按照empno（也可以ename）排序</span></span><br><span class="line">col ename for a60</span><br><span class="line"><span class="keyword">select</span> deptno, <span class="keyword">listagg</span>(ename,<span class="string">','</span>) <span class="keyword">within</span> <span class="keyword">group</span> (<span class="keyword">order</span> <span class="keyword">by</span> empno) <span class="keyword">as</span> ename</span><br><span class="line"><span class="keyword">from</span> scott.emp</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> deptno;</span><br><span class="line"></span><br><span class="line">    DEPTNO ENAME</span><br><span class="line"><span class="comment">---------- ------------------------------------------------------------</span></span><br><span class="line">        10 CLARK,KING,MILLER</span><br><span class="line">        20 SMITH,JONES,SCOTT,ADAMS,FORD</span><br><span class="line">        30 ALLEN,WARD,MARTIN,BLAKE,TURNER,JAMES</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按job分类，姓名聚合显示</span></span><br><span class="line">col ename for a60</span><br><span class="line"><span class="keyword">select</span> job, <span class="keyword">listagg</span>(ename,<span class="string">','</span>) <span class="keyword">within</span> <span class="keyword">group</span> (<span class="keyword">order</span> <span class="keyword">by</span> sal) <span class="keyword">as</span> ename</span><br><span class="line"><span class="keyword">from</span> scott.emp</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> job; <span class="comment">-- gruop by加上之后，select只能用job和聚合函数了！！！！</span></span><br><span class="line"></span><br><span class="line">JOB                ENAME</span><br><span class="line"><span class="comment">------------------ ------------------------------------------------------------</span></span><br><span class="line">ANALYST            FORD,SCOTT</span><br><span class="line">CLERK              SMITH,JAMES,ADAMS,MILLER</span><br><span class="line">MANAGER            CLARK,BLAKE,JONES</span><br><span class="line">PRESIDENT          KING</span><br><span class="line">SALESMAN           MARTIN,WARD,TURNER,ALLEN</span><br></pre></td></tr></table></figure>
<h3 id="比本部门平均工资高的人">比本部门平均工资高的人</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">col last_name for a20</span><br><span class="line"><span class="keyword">select</span> a.last_name,a.department_id,a.salary,b.average_salary</span><br><span class="line"><span class="keyword">from</span> hr.employees a,</span><br><span class="line">(<span class="keyword">select</span> department_id,<span class="keyword">avg</span>(salary) average_salary <span class="keyword">from</span> hr.employees <span class="keyword">group</span> <span class="keyword">by</span> department_id) b</span><br><span class="line"><span class="keyword">where</span> a.department_id = b.department_id</span><br><span class="line"><span class="keyword">and</span> a.salary &gt; b.average_salary;</span><br></pre></td></tr></table></figure>
<h3 id="输出所有人及对应的领导（注意null）">输出所有人及对应的领导（注意null）</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.first_name || <span class="string">' '</span> || e.last_name <span class="keyword">as</span> 职工全名</span><br><span class="line">,m.first_name || <span class="string">' '</span> || m.last_name <span class="keyword">as</span> 经理全名</span><br><span class="line"><span class="keyword">from</span> hr.employees e, hr.employees m</span><br><span class="line"><span class="keyword">where</span> e.manager_id = m.employee_id(+);</span><br></pre></td></tr></table></figure>
<p>==坑：有一个人没有领导==，他就是最大领导</p>
<h3 id="选普通群众（不是领导）">选普通群众（不是领导）</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- last_name </span></span><br><span class="line"><span class="comment">-- 嵌套</span></span><br><span class="line"><span class="keyword">select</span> last_name</span><br><span class="line"><span class="keyword">from</span> hr.employees</span><br><span class="line"><span class="keyword">where</span> employee_id <span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">(<span class="keyword">select</span> nvl(manager_id,<span class="number">0</span>) <span class="keyword">from</span> hr.employees);</span><br><span class="line"><span class="comment">-- 子查询将所有的领导id选出来了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关联</span></span><br><span class="line"><span class="keyword">select</span> e.last_name</span><br><span class="line"><span class="keyword">from</span> hr.employees e</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> hr.employees i</span><br><span class="line"><span class="keyword">where</span> e.employee_id = i.manager_id);</span><br><span class="line"><span class="comment">-- 对外部表每一个employee_id，传入内部表，看他是不是其他人的领导</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    
    <div style="text-align:center;color: #ccc;font-size:14px;">
-------------------------- the end~ &nbsp;&nbsp;
<i class="fa fa-heart-o" aria-hidden="true"></i>
 thanks for your reading~ --------------------------
</div>
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>zhx
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://yoursite.com/2020/03/10/Oracle/OracleSQL/" title="Oracle SQL">http://yoursite.com/2020/03/10/Oracle/OracleSQL/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Oracle/" rel="tag"><i class="fa fa-tag"></i> Oracle</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/02/25/Oracle/Oracle%E5%9F%BA%E6%93%8D/" rel="prev" title="Oracle 基操">
      <i class="fa fa-chevron-left"></i> Oracle 基操
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/03/10/Oracle/OracleSQL_part2/" rel="next" title="Oracle SQL_part2">
      Oracle SQL_part2 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>
  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0-SQL"><span class="nav-text">0 SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sql简介"><span class="nav-text">sql简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sql分类"><span class="nav-text">sql分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#语句解析过程"><span class="nav-text">语句解析过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sql语法注意"><span class="nav-text">sql语法注意</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#“大小写不敏感”"><span class="nav-text">“大小写不敏感”</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-QL"><span class="nav-text">1 QL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null的三值现象"><span class="nav-text">null的三值现象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Oracle中引号、字符串连接"><span class="nav-text">Oracle中引号、字符串连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#去重-distinct-unique"><span class="nav-text">去重 distinct &#x3D;&#x3D; unique</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#order-by"><span class="nav-text">order by</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#根据数字排序"><span class="nav-text">根据数字排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#根据别名排序"><span class="nav-text">根据别名排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#复合排序"><span class="nav-text">复合排序</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#having和where的区别"><span class="nav-text">having和where的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#比较符"><span class="nav-text">比较符</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#like"><span class="nav-text">like</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#转义-escape"><span class="nav-text">转义 - escape</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现top-n功能"><span class="nav-text">&#x3D;&#x3D;实现top n功能&#x3D;&#x3D;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#第一种方法"><span class="nav-text">第一种方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第二种方法（行限制子句，必考）"><span class="nav-text">第二种方法（行限制子句，必考）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查询时和用户交互"><span class="nav-text">查询时和用户交互</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1"><span class="nav-text">1. &amp;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-变量"><span class="nav-text">2. 变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3"><span class="nav-text">3. &amp;&amp;</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#访问多张表方法1-–-连接"><span class="nav-text">访问多张表方法1 – 连接</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#内部连接"><span class="nav-text">内部连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#外部连接（处理null）"><span class="nav-text">外部连接（处理null）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#左外连接"><span class="nav-text">左外连接</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#右外连接"><span class="nav-text">右外连接</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#全外连接"><span class="nav-text">全外连接</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多表连接"><span class="nav-text">多表连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自连接"><span class="nav-text">自连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#交叉连接（笛卡尔乘积）"><span class="nav-text">交叉连接（笛卡尔乘积）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自然连接"><span class="nav-text">自然连接</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#访问多张表方法2-–-子查询"><span class="nav-text">访问多张表方法2 – 子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#嵌套子查询"><span class="nav-text">嵌套子查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关联子查询"><span class="nav-text">关联子查询</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#处理多个结果集"><span class="nav-text">处理多个结果集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#伪列rownum-level"><span class="nav-text">伪列rownum level</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#别名"><span class="nav-text">别名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1’-QL函数"><span class="nav-text">1’ QL函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#字符型"><span class="nav-text">字符型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#lower-upper-initcap-concat"><span class="nav-text">lower upper initcap concat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#length"><span class="nav-text">length</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#substr"><span class="nav-text">substr</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#instr"><span class="nav-text">instr</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lpad-rpad"><span class="nav-text">lpad rpad</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#level-pad实现层次查询"><span class="nav-text">level + pad实现层次查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#trim"><span class="nav-text">trim</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数字型"><span class="nav-text">数字型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#round（四舍五入）"><span class="nav-text">round（四舍五入）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#trunc（四舍五舍）"><span class="nav-text">trunc（四舍五舍）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ceil-floor"><span class="nav-text">ceil floor</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mod"><span class="nav-text">mod</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#日期型"><span class="nav-text">日期型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#日期格式"><span class="nav-text">日期格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sysdate-current-date"><span class="nav-text">sysdate current_date</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#systimestamp-current-timestamp"><span class="nav-text">systimestamp current_timestamp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#date相减"><span class="nav-text">date相减</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其他日期函数？？？"><span class="nav-text">其他日期函数？？？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#日期的舍入-截断"><span class="nav-text">日期的舍入&#x2F;截断</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#转换函数"><span class="nav-text">转换函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#to-char"><span class="nav-text">to_char</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#日期转换为字符"><span class="nav-text">日期转换为字符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#数字转换为字符"><span class="nav-text">数字转换为字符</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#to-date（使用很多）"><span class="nav-text">to_date（使用很多）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#处理null值的函数"><span class="nav-text">处理null值的函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#NVL"><span class="nav-text">NVL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NVL2"><span class="nav-text">NVL2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NULLIF"><span class="nav-text">NULLIF</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#COALESC"><span class="nav-text">COALESC</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#处理if-then-else逻辑"><span class="nav-text">处理if-then-else逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CASE"><span class="nav-text">CASE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DECODE（使用很多）"><span class="nav-text">DECODE（使用很多）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组函数"><span class="nav-text">组函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#greatest-least"><span class="nav-text">greatest least</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#avg-count-max-min-sum"><span class="nav-text">avg count max min sum</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#listagg-列表聚合"><span class="nav-text">listagg 列表聚合</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#stddev-偏差"><span class="nav-text">stddev 偏差</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#variance-方差"><span class="nav-text">variance 方差</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rollup"><span class="nav-text">rollup</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cube"><span class="nav-text">cube</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1’’-QL练习题"><span class="nav-text">&#x3D;&#x3D;1’’ QL练习题&#x3D;&#x3D;</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#从全名中取lastname"><span class="nav-text">从全名中取lastname</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#根据入职时间长短排序"><span class="nav-text">根据入职时间长短排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如果mgr为空，mgr显示boss-0"><span class="nav-text">如果mgr为空，mgr显示boss&#x2F;0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#显示特定年份入职的员工数量"><span class="nav-text">显示特定年份入职的员工数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用case-decode改变表模式"><span class="nav-text">使用case&#x2F;decode改变表模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#聚合显示"><span class="nav-text">聚合显示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#比本部门平均工资高的人"><span class="nav-text">比本部门平均工资高的人</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#输出所有人及对应的领导（注意null）"><span class="nav-text">输出所有人及对应的领导（注意null）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#选普通群众（不是领导）"><span class="nav-text">选普通群众（不是领导）</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zhx"
      src="/images/avatar/yeah.jpg">
  <p class="site-author-name" itemprop="name">zhx</p>
  <div class="site-description" itemprop="description">中国南京 东南大学 软件学院</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xiangxiang-cpu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiangxiang-cpu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:harrison_zhanghx@foxmail.com" title="E-Mail → mailto:harrison_zhanghx@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/2284648070" title="QQ 2284648070 → 2284648070"><i class="fa fa-qq fa-fw"></i>QQ 2284648070</a>
      </span>
      <span class="links-of-author-item">
        <a href="/13182988567" title="weixin 13182988567 → 13182988567"><i class="fa fa-weixin fa-fw"></i>weixin 13182988567</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://creeper121386.github.io/" title="https:&#x2F;&#x2F;creeper121386.github.io" rel="noopener" target="_blank">WHY's blog</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-music"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhx</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  


  <!-- 鼠标效果 -->
  


  <!-- 动态背景 -->
  
</body>
</html>

